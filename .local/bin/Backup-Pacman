#!/bin/bash

# ref: https://askubuntu.com/a/30157/8698
if ! [ $(id -u) = 0 ]; then
   echo "The script needs to be run as root." >&2
   exit 1
fi

if [ $SUDO_USER ]; then
    real_user=$SUDO_USER
else
    real_user=$(whoami)
fi

# Commands that you don't want running as root would be invoked
# with: sudo -u $real_user
# So they will be run as the user who invoked the sudo command
# Keep in mind if the user is using a root shell (they're logged in as root),
# then $real_user is actually root
# sudo -u $real_user non-root-command

# Commands that need to be ran with root would be invoked without sudo
# root-command

# Create directory for installed packages if it doesn't exist
sudo -u $real_user mkdir -p /home/justine/Nextcloud/Justine-Laptop/Installed-Packages

#Backup packages
pacman -Qqen > /home/justine/Nextcloud/Justine-Laptop/Installed-Packages/archlinux-pkglist.txt

#Backup AUR
pacman -Qqem > /home/justine/Nextcloud/Justine-Laptop/Installed-Packages/archlinux-foreignpkglist.txt

# Copy users .config folder

sudo -u $real_user mkdir -p /home/justine/Nextcloud/Justine-Laptop/dotfiles/.config && sudo -u $real_user rsync -av  --delete /home/justine/.config /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Copy users .local folder

sudo -u $real_user mkdir -p /home/justine/Nextcloud/Justine-Laptop/dotfiles/.local && sudo -u $real_user rsync -av --delete --exclude 'TelegramDesktop' --exclude 'Nextcloud' /home/justine/.local /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Copy users .gtkrc-2.0

sudo -u $real_user rsync -av /home/justine/.gtkrc-2.0 /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Copy users .bashrc

sudo -u $real_user rsync -av /home/justine/.bashrc /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Copy users .bash_profile

sudo -u $real_user rsync -av /home/justine/.bash_profile /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Copy users .face image

sudo -u $real_user rsync -av /home/justine/.face /home/justine/Nextcloud/Justine-Laptop/dotfiles/

# Backup custom systemd services

sudo -u $real_user mkdir -p /home/justine/Nextcloud/Justine-Laptop/systemd && sudo -u $real_user rsync -av /etc/systemd/system/suspend@.service /home/justine/Nextcloud/Justine-Laptop/systemd/
sudo -u $real_user mkdir -p /home/justine/Nextcloud/Justine-Laptop/systemd && sudo -u $real_user rsync -av /etc/systemd/system/laptop-lid.service /home/justine/Nextcloud/Justine-Laptop/systemd/


